---
id: pun-3329
status: closed
deps: []
created: 2026-02-26T18:30:38Z
type: task
priority: 2
---
# Pulse animation should apply to in_progress tickets AND tickets with open plan questions. Fix transient pulsing on tickets that appear in_progress briefly but shouldn't be. Followup to pun-3ea3.

## Notes

**2026-02-26 19:19:13 UTC:** # Implementation Summary: pun-3329

## What Was Done

Successfully implemented pulse animation for tickets with open plan questions and fixed transient pulsing during status transitions.

### Changes Made

All three planned tasks were completed in `Punchlist/Views/ItemRow.swift`:

1. **Added `hasOpenPlanQuestions` computed property (lines 37-40)**
   - Checks if `item.planQuestions` is non-nil and non-empty
   - Returns `false` if the array is nil or empty

2. **Extended `hasPulse` logic (lines 42-44)**
   - Changed from `isInProgress` to `isInProgress || hasOpenPlanQuestions`
   - Now triggers pulse animation for both in-progress tickets AND tickets with unanswered plan questions

3. **Fixed transient pulsing in opacity calculations**
   - **Border stroke opacity (line 96)**: Changed from `hasPulse ? (pulseActive ? 0.5 : 0.15) : 0.3` to `hasPulse && pulseActive ? 0.5 : (hasPulse ? 0.15 : 0.3)`
   - **Shadow opacity (line 98)**: Changed from `hasPulse ? (pulseActive ? 0.28 : 0.03) : 0.12` to `hasPulse && pulseActive ? 0.28 : (hasPulse ? 0.03 : 0.12)`
   - **Circle fill opacity (line 250)**: Changed from `hasPulse ? (pulseActive ? 0.4 : 0.15) : 0.18` to `hasPulse && pulseActive ? 0.4 : (hasPulse ? 0.15 : 0.18)`

## Notable Decisions

**Plan questions as "open" when present**: Since the app doesn't persist question answers in the Item model (answers are submitted to the server immediately via ephemeral UI state), we treat any ticket with a non-empty `planQuestions` array as having "open" questions that need user input. This matches the expected UX behavior - once questions are answered and submitted, the server clears them from the item.

**Explicit boolean logic over nested ternaries**: The fix for transient pulsing uses explicit `hasPulse && pulseActive` checks in the conditional operator's condition clause, rather than nested ternaries. This ensures that if `pulseActive` is still `true` but `hasPulse` has become `false` (e.g., during a status transition), the animation state doesn't show through.

## Verification

- All existing tests pass (PunchlistTests suite: 31 tests passed)
- No test coverage for view animations (SwiftUI view tests not present in codebase)
- Manual verification required for visual pulse behavior

## Invariants Check

No invariants violated:
- Maintains SwiftUI-only architecture
- No new dependencies added
- No local persistence introduced
- Changes are view-layer only, no model changes
- Follows existing code patterns

## What Future Readers Should Know

The pulse animation system has two independent concerns now:
1. **Active work**: Items with `in_progress` status pulse to indicate the agent is working
2. **Pending input**: Items with unanswered plan questions pulse to draw user attention

Both cases use the same visual pulse effect. The animation lifecycle is managed by `onChange(of: hasPulse)` which starts/stops the `pulseActive` animation state. The explicit `hasPulse && pulseActive` checks prevent stale animation state from showing during status transitions.

**2026-02-26 19:19:13 UTC:** ko: SUCCEED
